<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A website interface for the Hibike! Euphonium Archive project.">
    
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="Hibike! Euphonium Archive">
    {% if metadata and metadata.title %}
    <meta property="og:title" content="{{ metadata.title }}">
    {% else %}
    <meta property="og:title" content="Hibike! Euphonium Archive">
    {% endif %}
    {% if metadata and metadata.url %}
    <meta property="og:url" content="{{ metadata.url }}">
    {% else %}
    <meta property="og:url" content="https://hibike-euphonium-archive.herokuapp.com/">
    {% endif %}
    {% if metadata and metadata.description %}
    <meta property="og:description" content="{{ metadata.description }}">
    {% else %}
    <meta property="og:description" content="A website interface for the Hibike! Euphonium Archive project.">
    {% endif %}
    {% if metadata and metadata.image %}
    <meta property="og:image" content="{{ metadata.image }}">
    {% else %}
    <meta property="og:image" content="https://hibike-euphonium-archive.herokuapp.com/static/images/lizicon.png">
    {% endif %}
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="900">
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='custom.css') }}">
    <link rel="shortcut icon" type="image/png" href="/static/images/lizicon.png"/>
    {% if title %}
        <title>{{ title }}</title>
    {% else %}
        <title>Hibike! Euphonium Archive</title>
    {% endif %}
    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
        ga('create', 'UA-189053212-1', 'auto');
        ga('send', 'pageview');
    </script>
    <!-- End Google Analytics -->
</head>
<body id="main-wrapper">
    {% block header %}
    {% endblock %}

    <script>
        // fadeout for flashed messages
        setTimeout(function() {
            $('[id=fadeout]').fadeOut(500,function() {
                $('[id=fadeout]').css({"visibility":"hidden",display:'block'}).slideUp();
            });
        }, 5000);

        // suppresses default error popup for required form fields
        document.addEventListener('invalid', (function () {
            return function (e) {
                e.preventDefault();
            };
        })(), true);

        {% if current_user.is_authenticated %}
        // search suggestions autocomplete below
        function search_autocomplete(inp, arr) {
            var currentFocus;

            // checks for new input
            inp.addEventListener("input", function(e) {
                var a, b, i, val = this.value;
                closeAllLists();
                if (!val) { return false;}
                currentFocus = -1;
                
                // div element containing tags
                a = document.createElement("DIV");
                a.setAttribute("id", this.id + "autocomplete-list-search");
                a.setAttribute("class", "autocomplete-items-search");
                this.parentNode.appendChild(a);
                
                var numItems = 0;
                for (i = 0; i < arr.length; i++) {
                    // check for same initial letters ignoring case and limits results to 5
                    if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase() && numItems++ < 5) {
                        b = document.createElement("DIV");
                        b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                        b.innerHTML += arr[i].substr(val.length);
                        b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                        b.setAttribute("style", "padding:3px")

                        // called when tag is clicked
                        b.addEventListener("click", function(e) {
                            inp.value = this.getElementsByTagName("input")[0].value;
                            closeAllLists();
                        });
                    a.appendChild(b);
                    }
                }

                // selects first item
                if (numItems > 0) {
                    var x = document.getElementById(this.id + "autocomplete-list-search");
                    if (x) x = x.getElementsByTagName("div");
                    currentFocus++;
                    addActive(x);
                }
            });

            // checks when key is pressed
            inp.addEventListener("keydown", function(e) {
                var x = document.getElementById(this.id + "autocomplete-list-search");
                if (x) x = x.getElementsByTagName("div");
                if (e.keyCode == 40) { // down
                    currentFocus++;
                    addActive(x);
                } else if (e.keyCode == 38) { // up
                    currentFocus--;
                    addActive(x);
                } else if (e.keyCode == 13 && document.getElementsByClassName("autocomplete-active-search").length != 0) { // enter
                    e.preventDefault();
                    if (currentFocus > -1) {
                        if (x) x[currentFocus].click();
                    }
                }
            });

            // select tag
            function addActive(x) {
                if (!x) return false;
                removeActive(x);
                if (currentFocus >= x.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = (x.length - 1);
                x[currentFocus].classList.add("autocomplete-active-search");
            }

            // deselect tag
            function removeActive(x) {
                for (var i = 0; i < x.length; i++) {
                    x[i].classList.remove("autocomplete-active-search");
                }
            }

            // close tag list
            function closeAllLists(elmnt) {
                var x = document.getElementsByClassName("autocomplete-items-search");
                for (var i = 0; i < x.length; i++) {
                    if (elmnt != x[i] && elmnt != inp) {
                        x[i].parentNode.removeChild(x[i]);
                    }
                }
            }

            document.addEventListener("click", function (e) {
                closeAllLists(e.target);
            });
        }

        // extract server response
        var search_dict = { "search_tags" : {{ searchtags|tojson }} };
        var search_tags = search_dict.search_tags;

        search_autocomplete(document.getElementById("searchInput"), search_tags);
        {% endif %}
    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha384-xBuQ/xzmlsLoJpyjoggmTEz8OWUFM0/RC5BsqQBDX2v5cMvDHcMakNTNrHIW2I5f" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>